# 完整的 Nginx 配置示例
# 文件位置: /etc/nginx/sites-available/default

# HTTP 块 - 全局配置
http {
    # 上游服务器配置 - 定义后端服务
    upstream party_backend {
        server 127.0.0.1:3000;  # 党员统计系统后端
    }
    
    upstream other_app_backend {
        server 127.0.0.1:4000;  # 其他应用后端（示例）
    }
    
    # 服务器块 - 处理具体的域名和端口
    server {
        listen 80;                # 监听 80 端口
        server_name your-domain.com;  # 你的域名
        
        # 设置上传文件大小限制
        client_max_body_size 50M;
        
        # 根路径 - 可以是默认页面或其他应用
        location / {
            root /var/www/html;
            index index.html;
        }
        
        # 党员统计系统 - 子路径 /partysta
        location /partysta {
            proxy_pass http://party_backend;  # 使用上面定义的 upstream
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        
        # 其他应用示例 - 子路径 /other-app
        location /other-app {
            proxy_pass http://other_app_backend;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        
        # 静态文件缓存
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
}